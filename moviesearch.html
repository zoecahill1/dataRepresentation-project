<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Movie Search</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>
<body>

  <div class="main-header">
    <div class="inner">
      <h1 class="main-title">Search for details of movie</h1>
      <form class="search-form">
        <label class="is-hidden" for="search">Search by name</label>
        <input type="search" name="search" id="search" placeholder="Search movie...">

        <button type="submit" id="submit" class="search-button"><i class="material-icons icn-search">search</i></button>
      </form>   
    </div>   
  </div>

  <div class="main-content clearfix">
    <ul id="movies" class="movie-list">      

    </ul> 
  </div>


	<script src="http://code.jquery.com/jquery-1.12.0.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  <script>

$(document).ready(function (){
	let apikey = "c460f163";
	// Search function
	function search() {
		// Grab the search term value from input field
		let searchTerm = $('#search').val().toLowerCase(),			
				// Set empty HTML value for printing to page after getting search results
				movieHTML = "";
		$.ajax({
			url: 'http://www.omdbapi.com/?apikey=' + apikey + '&s=' + searchTerm,
			method: 'GET',
			dataType: 'json',
			success: function(data) { // If search is successful, create HTMl with list items of movies
				 
					if (data.Response === "True") {
						$.each(data.Search, function(i, movie) {
								movieHTML += '<li id="' + movie.imdbID + '"><div class="poster-wrap">';
									if (movie.Poster != "N/A") { // If poster is available, display it
										movieHTML += '<a class="movie-poster" href="#" data-toggle="modal" data-target="#' + movie.imdbID + '"><img src="' + movie.Poster + '"></a>';
									} else { // If not, display icon placeholder
										movieHTML += "<i class='material-icons poster-placeholder'>crop_original</i>";
									}
								movieHTML += '</div>';
								movieHTML += '<span class="movie-title">' + movie.Title + '</span>';														
						});						
					} else if (data.Response === "False") { // If the response is false and no movies are found, display message
						movieHTML += '<li class="no-movies"><i class="material-icons icon-help">help_outline</i>No movies found that match: ' + searchTerm;
						$('.movie-list').html(movieHTML);
					}
			// Add HTML to page
			$('.movie-list').html(movieHTML); // Print the HTML with list of movies to the page
				
			},
		}); 
	}

	
	$('#movies').on('click', "li", function(e) {		
		
		//Prevents the bootstrap modal from bubbling the add '.in' class to the target click
		e.stopPropagation();
		let movieModal = "",
				movieId = $(this).attr('id');
		
		$.ajax({
			url: 'http://www.omdbapi.com/?apikey=' + apikey + '&i=' + movieId + '&plot=full',
			method: 'GET',
			dataType: 'json',
			success: function(data) {				
					movieModal += '<div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">' + data.Title + ' (' + data.Year + ')' + '</h4></div>';
					movieModal += '<div class="modal-body">' + '<img src="' + data.Poster + '"><br><br>IMDB Rating: ' + data.imdbRating + '<br><br>Plot Synopsis:<br>' + data.Plot + '</div>';
					movieModal += '<div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button><a href="http://www.imdb.com/title/' + data.imdbID +'" target="_blank"><button type="button" class="btn btn-primary">Link to IMDB</button></a></div></div>';
			$('.modal-dialog').html(movieModal); // Update the clicked modal
			$('#posterModal').modal('show');
			}
		}); // End AJAX call


	});// End Click function

	

	let delay = (function(){
	  let timer = 0;
	  return function(callback, ms){
	    clearTimeout (timer);
	    timer = setTimeout(callback, ms);
	  };
	})();
	//Keyup Function
	$('input').keyup(function(){
		delay(function(){
			search();
		}, 500);
	});
});

  </script>

  <div class="modal fade in" tabindex="-1" role="dialog" id="posterModal">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title"></h4>
        </div>
        <div class="modal-body"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <a href="http://www.imdb.com/title/" target="_blank">
            <button type="button" class="btn btn-primary">Link to IMDB</button>
          </a>
        </div>
      </div>
    </div>
  </div>
</body>
</html>